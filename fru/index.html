<html>
    <head>
        <title>FRU Lookup and system service parts index - ThinkPads.org</title>
        <link rel="shortcut icon" href="/res/dot.png">
        <link rel="stylesheet" href="/res/main.css"/>
        <script src="https://cdn.rawgit.com/showdownjs/showdown/1.8.2/dist/showdown.min.js" type="text/javascript"></script>
    </head>
    <body>
    
        <div id="header-cont"></div>
        <div class="body-wrap-fru">
            <h1>FRU Lookup and system service parts index</h1>
            <p>Please search and select your ThinkPad Model</p>
            <p style="color: gray">Data updated on the 3rd of January 2018</p>
            <label>Model:</label>
            <input oninput="perform_search(this)" id="search">
            <button onclick="clear_search()">Clear</button>
            <p id="status">Loading...</p>
            <table class="fru-table" id="fru-table-main">
                    <tr>
                        <th class="fru-model">Model</th>
                        <th class="ass">LCD assembly diagram</th>
                        <th class="ass">Main assembly diagram</th>
                        <th class="fru-idx">FRU Index</th>
                    </tr>
                <tbody id="fru-table-body">
                </tbody>
            </table>
            
        </div>
        
        <div id="footer-cont"></div>
        
        <div style="display: none">
            
            <div class="ass-div" id="lcd-template">
            <a onclick="open_lcd_ass(this)" href="#">LCD Assembly</a>
            <img src="/res/new-window.png">
            </div>
            
             <div class="ass-div" id="main-template">
            <a href="#" onclick="open_main_ass(this)">Main Assembly</a>
            <img src="/res/new-window.png">
            </div>
        
        </div>
        
    </body>
    
    <script src="/res/header.js" type="text/javascript"></script>
    <script src="/res/footer.js" type="text/javascript"></script>
    <script type="text/javascript">
    
        String.prototype.contains = function(str) {
            if (this.toLowerCase().indexOf(str.toLowerCase()) == -1) {
                return false;
            }
            return true;
        }
        
        var template_html = null;
        var models = null;
        var search_result = null;
        
        function http_get(link, callback) {
            xhr = new XMLHttpRequest()
            xhr.onreadystatechange = function() {
                if (this.status == 200 && this.readyState == 4) {
                    callback(xhr.responseText);
                }
            }
            xhr.open("GET", link)
            xhr.send()
        }
        
        function load_models() {
            http_get("/fru/index.json", function(text) {
                models = JSON.parse(text);
                display_data(models);
            });
        }
        
        function display_data(data) {
            /* First, clear the table */
            var table = document.getElementById("fru-table-main");
            var tbody_old = document.getElementById("fru-table-body")
            var tbody = document.createElement("tbody");
            
            template_lcd = document.getElementById("lcd-template");
            template_main = document.getElementById("main-template");
            
            /* Populate the data */
            for (let i = 0; i < data.length; i++) {
                
                lcd_ass = "Not Available"
                main_ass = "Not Available"
                
                if (data[i].lcd_ass != "null") {
                    lcd_ass = template_lcd.innerHTML;
                }
                
                if (data[i].main_ass != "null") {
                    main_ass = template_main.innerHTML;
                }
                
                template = template_html.replace("NAME", data[i].name);
                template = template.replace("LCD_ASS", lcd_ass);
                template = template.replace("MAIN_ASS", main_ass);
                template = template.replace("FRU_IDX", "#");
                element = document.createElement("tr");
                element.innerHTML = template;
                element.data = data[i];
                tbody.appendChild(element);
            }
            
            tbody.setAttribute("id", "fru-table-body")
            table.replaceChild(tbody, tbody_old);
            set_status(data.length + " result(s)")
        }
        
        function perform_search(object) {
            if (object.value == "") {
                display_data(models);
                return;
            }
            search_result = [];
            for (let i = 0; i < models.length; i++) {
                if (models[i].name.contains(object.value)) {
                    search_result.push(models[i]);
                }
            }
            display_data(search_result);
        }
        
        function open_lcd_ass(element) {
            url = element.parentNode.parentNode.data.lcd_ass;
            window.open(url);
        }
        
        function open_main_ass(element) {
            url = element.parentNode.parentNode.data.main_ass;
            window.open(url);
        }
        
        function set_status(status) {
            document.getElementById("status").innerHTML = status;
        }
        
        function clear_search() {
            document.getElementById("search").value = "";
            display_data(models);
        }
        
        http_get("/res/fru-mod-tr.html", function(text) {
            template_html = text;
            load_models();
        });
    
    </script>
</html>